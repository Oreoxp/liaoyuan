# æ€§èƒ½é—®é¢˜ä¿®å¤æ€»ç»“

## ğŸš¨ é—®é¢˜ç°è±¡

æ¸¸æˆå‡ºç°ä¸¥é‡å¡é¡¿ï¼Œè¡¨ç°ä¸ºæ…¢åŠ¨ä½œæ•ˆæœï¼ŒFPSå¤§å¹…ä¸‹é™ã€‚

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### 1. **é¢‘ç¹çš„æ•Œäººæœç´¢**
- **é—®é¢˜**ï¼š`find_nearest_enemy()` å‡½æ•°åœ¨æ¯ä¸€å¸§éƒ½è¢«è°ƒç”¨
- **å½±å“**ï¼šæ¯æ¬¡éƒ½è¦éå†æ‰€æœ‰æ•Œäººï¼Œè®¡ç®—è·ç¦»
- **é¢‘ç‡**ï¼š60FPSæ—¶æ¯ç§’æ‰§è¡Œ60æ¬¡å®Œæ•´æœç´¢

### 2. **é¢‘ç¹çš„ç©å®¶æŸ¥æ‰¾**
- **é—®é¢˜**ï¼šæ¯ä¸ªæ•Œäººåœ¨æ¯ä¸€å¸§éƒ½æŸ¥æ‰¾ç©å®¶
- **å½±å“**ï¼š`get_tree().get_first_node_in_group("player")` è¢«é¢‘ç¹è°ƒç”¨
- **é¢‘ç‡**ï¼šå¦‚æœæœ‰10ä¸ªæ•Œäººï¼Œæ¯ç§’æ‰§è¡Œ600æ¬¡ç©å®¶æŸ¥æ‰¾

### 3. **ç¼ºä¹ç¼“å­˜æœºåˆ¶**
- **é—®é¢˜**ï¼šæ²¡æœ‰ç¼“å­˜æœ€è¿‘çš„è®¡ç®—ç»“æœ
- **å½±å“**ï¼šé‡å¤æ‰§è¡Œç›¸åŒçš„è®¡ç®—
- **åæœ**ï¼šCPUèµ„æºæµªè´¹ï¼Œæ€§èƒ½ä¸‹é™

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. **æ•Œäººæœç´¢ç¼“å­˜ä¼˜åŒ–**
```gdscript
# ç¼“å­˜æœ€è¿‘çš„æ•Œäººï¼Œé¿å…æ¯å¸§éƒ½æœç´¢
var cached_nearest_enemy: Node2D = null
var last_enemy_search_time: float = 0.0
const ENEMY_SEARCH_INTERVAL: float = 0.1 # æ¯0.1ç§’æœç´¢ä¸€æ¬¡æ•Œäºº

func find_nearest_enemy() -> Node2D:
    # æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
    if is_instance_valid(cached_nearest_enemy):
        if cached_nearest_enemy.has_method("take_damage") and cached_nearest_enemy.is_in_group("enemies"):
            return cached_nearest_enemy
    
    # é™åˆ¶æœç´¢é¢‘ç‡
    var current_time = Time.get_time_dict_from_system()["second"]
    if current_time - last_enemy_search_time < ENEMY_SEARCH_INTERVAL:
        return cached_nearest_enemy
    
    # æ‰§è¡Œæœç´¢å¹¶æ›´æ–°ç¼“å­˜
    # ...
```

### 2. **ç©å®¶æŸ¥æ‰¾é¢‘ç‡é™åˆ¶**
```gdscript
# ç¼“å­˜ç©å®¶æŸ¥æ‰¾æ—¶é—´ï¼Œé¿å…é¢‘ç¹æŸ¥æ‰¾
var last_player_search_time: float = 0.0
const PLAYER_SEARCH_INTERVAL: float = 1.0 # æ¯1ç§’æŸ¥æ‰¾ä¸€æ¬¡ç©å®¶

func _physics_process(delta: float) -> void:
    if player == null:
        # é™åˆ¶æŸ¥æ‰¾ç©å®¶çš„é¢‘ç‡
        var current_time = Time.get_time_dict_from_system()["second"]
        if current_time - last_player_search_time >= PLAYER_SEARCH_INTERVAL:
            player = get_tree().get_first_node_in_group("player")
            last_player_search_time = current_time
        return
```

### 3. **è°ƒè¯•æ—¥å¿—ä¼˜åŒ–**
```gdscript
# åªåœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¾“å‡ºæ—¥å¿—
if OS.is_debug_build():
    print("Player: Shooting at enemy at position ", enemy.global_position)
```

## ğŸ“Š æ€§èƒ½æå‡æ•ˆæœ

### ä¿®å¤å‰
- **æ•Œäººæœç´¢é¢‘ç‡**ï¼š60æ¬¡/ç§’
- **ç©å®¶æŸ¥æ‰¾é¢‘ç‡**ï¼š600æ¬¡/ç§’ï¼ˆ10ä¸ªæ•Œäººï¼‰
- **CPUä½¿ç”¨ç‡**ï¼šé«˜
- **FPS**ï¼šä½ï¼Œå‡ºç°å¡é¡¿

### ä¿®å¤å
- **æ•Œäººæœç´¢é¢‘ç‡**ï¼š10æ¬¡/ç§’ï¼ˆé™ä½83%ï¼‰
- **ç©å®¶æŸ¥æ‰¾é¢‘ç‡**ï¼š10æ¬¡/ç§’ï¼ˆé™ä½98%ï¼‰
- **CPUä½¿ç”¨ç‡**ï¼šæ˜¾è‘—é™ä½
- **FPS**ï¼šæ¢å¤æ­£å¸¸

## ğŸ¯ å…³é”®ä¼˜åŒ–ç­–ç•¥

### 1. **ç¼“å­˜æœºåˆ¶**
- **æ—¶é—´ç¼“å­˜**ï¼šé™åˆ¶æœç´¢é¢‘ç‡
- **ç»“æœç¼“å­˜**ï¼šç¼“å­˜æœ€è¿‘çš„è®¡ç®—ç»“æœ
- **çŠ¶æ€ç¼“å­˜**ï¼šé¿å…é‡å¤çŠ¶æ€æ£€æŸ¥

### 2. **é¢‘ç‡æ§åˆ¶**
- **æœç´¢é—´éš”**ï¼š0.1ç§’æœç´¢ä¸€æ¬¡æ•Œäºº
- **æŸ¥æ‰¾é—´éš”**ï¼š1ç§’æŸ¥æ‰¾ä¸€æ¬¡ç©å®¶
- **æ—¥å¿—é—´éš”**ï¼šåªåœ¨è°ƒè¯•æ¨¡å¼è¾“å‡º

### 3. **ç®—æ³•ä¼˜åŒ–**
- **è·ç¦»å¹³æ–¹**ï¼šä½¿ç”¨ `distance_squared_to` é¿å…å¼€æ–¹è¿ç®—
- **æ—©æœŸé€€å‡º**ï¼šæ— æ•ˆå¯¹è±¡ç«‹å³è·³è¿‡
- **æ‰¹é‡å¤„ç†**ï¼šå‡å°‘å•æ¬¡æ“ä½œçš„å¼€é”€

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### ç¼“å­˜éªŒè¯
```gdscript
# éªŒè¯ç¼“å­˜å¯¹è±¡æ˜¯å¦ä»ç„¶æœ‰æ•ˆ
if is_instance_valid(cached_nearest_enemy):
    if cached_nearest_enemy.has_method("take_damage") and cached_nearest_enemy.is_in_group("enemies"):
        return cached_nearest_enemy
```

### æ—¶é—´æ§åˆ¶
```gdscript
# ä½¿ç”¨ç³»ç»Ÿæ—¶é—´æ§åˆ¶é¢‘ç‡
var current_time = Time.get_time_dict_from_system()["second"]
if current_time - last_search_time < SEARCH_INTERVAL:
    return cached_result
```

### è°ƒè¯•æ¨¡å¼æ§åˆ¶
```gdscript
# åªåœ¨å¼€å‘æ—¶è¾“å‡ºè¯¦ç»†æ—¥å¿—
if OS.is_debug_build():
    print("è°ƒè¯•ä¿¡æ¯")
```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### åˆ›å»ºæ€§èƒ½ç›‘æ§è„šæœ¬
```gdscript
# performance_monitor.gd
extends Node

func _process(delta: float):
    # ç›‘æ§FPS
    # ç»Ÿè®¡å¯¹è±¡æ•°é‡
    # æ£€æŸ¥å¯¹è±¡æ± çŠ¶æ€
    # è¾“å‡ºæ€§èƒ½è­¦å‘Š
```

### å…³é”®æŒ‡æ ‡
- **FPS**ï¼šç›®æ ‡60FPS
- **å¸§æ—¶é—´**ï¼šç›®æ ‡16.67ms
- **å¯¹è±¡æ•°é‡**ï¼šç›‘æ§åœºæ™¯å¤æ‚åº¦
- **å†…å­˜ä½¿ç”¨**ï¼šé˜²æ­¢å†…å­˜æ³„æ¼

## ğŸ¯ æ€»ç»“

è¿™æ¬¡æ€§èƒ½ä¼˜åŒ–ä¸»è¦è§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š

1. **æ¶ˆé™¤äº†æ€§èƒ½ç“¶é¢ˆ**ï¼šå‡å°‘äº†ä¸å¿…è¦çš„é‡å¤è®¡ç®—
2. **ä¼˜åŒ–äº†ç®—æ³•æ•ˆç‡**ï¼šä½¿ç”¨ç¼“å­˜å’Œé¢‘ç‡æ§åˆ¶
3. **æ”¹å–„äº†ç”¨æˆ·ä½“éªŒ**ï¼šæ¶ˆé™¤äº†å¡é¡¿å’Œæ…¢åŠ¨ä½œ
4. **æé«˜äº†ä»£ç è´¨é‡**ï¼šæ›´å¥½çš„æ€§èƒ½æ„è¯†å’Œä¼˜åŒ–å®è·µ

è¿™å†æ¬¡è¯æ˜äº†"æ€§èƒ½ä¼˜åŒ–"çš„é‡è¦æ€§ï¼šä¸ä»…è¦è®©ä»£ç å·¥ä½œï¼Œè¿˜è¦è®©ä»£ç é«˜æ•ˆå·¥ä½œã€‚ 